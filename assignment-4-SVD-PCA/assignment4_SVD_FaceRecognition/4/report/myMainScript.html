
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>myMainScript</title><meta name="generator" content="MATLAB 9.9"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2020-11-06"><meta name="DC.source" content="myMainScript.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">Question 4 Report</a></li><li><a href="#2">ORL Dataset Face Recognition</a></li><li><a href="#3">Error Rate (ORL Dataset) with Matlab's svd function</a></li><li><a href="#4">Error rate (ORL Dataset) using eig function</a></li><li><a href="#5">Yale Dataset Face Recognition</a></li><li><a href="#6">Error Rate (Yale Dataset) with top eigen values</a></li><li><a href="#7">Error Rate (Yale Dataset) with top (but 3) eigen values</a></li><li><a href="#8">References (last accessed 4-11-2020)</a></li></ul></div><h2 id="1">Question 4 Report</h2><h2 id="2">ORL Dataset Face Recognition</h2><p>A combined image vector space as created across all training images (as opposed to seperate eigen vectors per individual) After normalising 'U' generated by Matlab's svd function, we create a search space by premultiplying the training image column vectors. The query image is then mapped to this search space of eigen coefficients by premultiplying with U and then knnsearch is used to evaluate which person the query image may correspond to. The resultant recognition is compared with the true identity, and we report our error rate in number of missed identifications/total number of test images.</p><h2 id="3">Error Rate (ORL Dataset) with Matlab's svd function</h2><p>Miminum identification errors were observed when top 50 eigen values were retained</p><img vspace="5" hspace="5" src="myMainScript_01.png" alt=""> <h2 id="4">Error rate (ORL Dataset) using eig function</h2><img vspace="5" hspace="5" src="myMainScript_02.png" alt=""> <h2 id="5">Yale Dataset Face Recognition</h2><p>An initial hurdle was faced due to the dataset being incomplete, we anticipated 64 images for each individual but instead for some individuals we had 60-63 images (B10,12,13 - 60, B16 - 62, B15,17,18 - 63 images respectively) This data set was evaluated using matlab's inbuilt SVD function, retaining either top eigen vectors, or in the second case retaining top eigen values except the top 3 eigen vectors.</p><h2 id="6">Error Rate (Yale Dataset) with top eigen values</h2><p>When retaining all Eigen Values, performance on the given test image test is not very good, and performance keeps improving even when 1000 eigen vectors are retained, this is unlike the expected behaviour of a minima (concavity) in the shape of error vs. number of eigen values retained. This Performance prompts the question whether the largest eigen values hold meaning, and we test that in the next section where top eigen values excluding top 3 eigen values are used to identify the faces.</p><img vspace="5" hspace="5" src="myMainScript_03.png" alt=""> <h2 id="7">Error Rate (Yale Dataset) with top (but 3) eigen values</h2><p>Performance improves substantially once top eigen values are ignored as can be seen in the plot below, allowing us to hit 40% accuracy.</p><img vspace="5" hspace="5" src="myMainScript_04.png" alt=""> <h2 id="8">References (last accessed 4-11-2020)</h2><p><a href="https://in.mathworks.com/matlabcentral/answers/166629-is-there-any-way-to-list-all-folders-only-in-the-level-directly-below-a-selected-directory">https://in.mathworks.com/matlabcentral/answers/166629-is-there-any-way-to-list-all-folders-only-in-the-level-directly-below-a-selected-directory</a></p><p><a href="https://in.mathworks.com/matlabcentral/answers/341843-load-files-from-relative-path">https://in.mathworks.com/matlabcentral/answers/341843-load-files-from-relative-path</a></p><p><a href="https://in.mathworks.com/matlabcentral/answers/40018-delete-zeros-rows-and-columns">https://in.mathworks.com/matlabcentral/answers/40018-delete-zeros-rows-and-columns</a></p><pre class="codeoutput">Elapsed time is 102.103022 seconds.
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Question 4 Report

tic;
%% ORL Dataset Face Recognition
% A combined image vector space as created across all training images (as opposed to seperate eigen vectors per individual)
% After normalising 'U' generated by Matlab's svd function, we
% create a search space by premultiplying the training image column
% vectors. The query image is then mapped to this search space of eigen
% coefficients by premultiplying with U and then knnsearch is used to
% evaluate which person the query image may correspond to. The resultant
% recognition is compared with the true identity, and we report our error
% rate in number of missed identifications/total number of test images.
% 
clear;
[trainvecspace, testvecspace, trainnumimg, testnumimg, imgrownum, imgcolnum] = orldataloader();
meanvec = mean(trainvecspace,2);
trainvecspace = bsxfun(@minus,trainvecspace,meanvec);
[U,S,V] = svd(trainvecspace,'econ');
%[sortU, sortS, sortV] = mySVD(trainvecspace);
%% Error Rate (ORL Dataset) with Matlab's svd function
% Miminum identification errors were observed when top 50 eigen values were
% retained
orlplotsvd = [];
for k = [1, 2, 3, 5, 10, 15, 20, 30, 50, 75, 100, 150, 170]
    Ured = zeros(size(U));
    Ured(:,1:k) = U(:,1:k);
    eigenvec = Ured';
    searchspace = eigenvec*trainvecspace;
    toterr=0;
    %totdist = 0;
    for i = 1:size(testvecspace,2)
        queryimg = eigenvec*(testvecspace(:,i)-meanvec);
        [idx,Dist] = knnsearch(searchspace',queryimg');
        if floor((idx-1)/trainnumimg) ~= floor((i-1)/(testnumimg))
            toterr = toterr+1;
        end
        %totdist = totdist + Dist;
    end
    orlplotsvd = [orlplotsvd (100*toterr/size(testvecspace,2))];
    %disp(toterr/size(testvecspace,2))
    %disp(totdist)
end
X = [1, 2, 3, 5, 10, 15, 20, 30, 50, 75, 100, 150, 170];
plot(X,orlplotsvd)
title('Error Rate (ORL dataset, matlab inbuilt svd)')
xlabel('Number of eigen values retained')
ylabel('Error rate (Percentage of incorrect identifications)')

%% Error rate (ORL Dataset) using eig function
L = trainvecspace'*trainvecspace;
[W ,D] = eig(L);
Uo = trainvecspace*W;
[singular_vals,idx] = sort(diag(D), 'descend');
U = Uo(:, idx);
orlplotsvd = [];
for k = [1, 2, 3, 5, 10, 15, 20, 30, 50, 75, 100, 150, 170]
    Ured = zeros(size(U));
    Ured(:,1:k) = U(:,1:k);
    eigenvec = Ured';
    searchspace = eigenvec*trainvecspace;
    toterr=0;
    %totdist = 0;
    for i = 1:size(testvecspace,2)
        queryimg = eigenvec*(testvecspace(:,i)-meanvec);
        [idx,Dist] = knnsearch(searchspace',queryimg');
        if floor((idx-1)/trainnumimg) ~= floor((i-1)/(testnumimg))
            toterr = toterr+1;
        end
        %totdist = totdist + Dist;
    end
    orlplotsvd = [orlplotsvd (100*toterr/size(testvecspace,2))];
    %disp(toterr/size(testvecspace,2))
    %disp(totdist)
end
X = [1, 2, 3, 5, 10, 15, 20, 30, 50, 75, 100, 150, 170];
plot(X,orlplotsvd)
title('Error Rate (ORL dataset, eig function)')
xlabel('Number of eigen values retained')
ylabel('Error rate (Percentage of incorrect identifications)')


%% Yale Dataset Face Recognition
% An initial hurdle was faced due to the dataset being incomplete, we
% anticipated 64 images for each individual but instead for some
% individuals we had 60-63 images (B10,12,13 - 60, B16 - 62, B15,17,18 - 63 images respectively)
% This data set was evaluated using matlab's inbuilt SVD function,
% retaining either top eigen vectors, or in the second case retaining top
% eigen values except the top 3 eigen vectors.
clear;
[trainvecspace, testvecspace, imgrownum, imgcolnum, corrtraintag, corrtesttag] = yaledataloader();
meanvec = mean(trainvecspace,2);
trainvecspace = bsxfun(@minus,trainvecspace,meanvec);
testvecspace = bsxfun(@minus,testvecspace,meanvec);
[U,S,V] = svd(trainvecspace,'econ');
%B18 -63
%B17 - 63
%B16 - 62
%B15 - 63
%B13 - 60
%B12 - 60
%B11 - 60
%% Error Rate (Yale Dataset) with top eigen values
% When retaining all Eigen Values, performance on the given test image test
% is not very good, and performance keeps improving even when 1000 eigen
% vectors are retained, this is unlike the expected behaviour of a minima
% (concavity) in the shape of error vs. number of eigen values retained.
% This Performance prompts the question whether the largest eigen values
% hold meaning, and we test that in the next section where top eigen
% values excluding top 3 eigen values are used to identify the faces.
startk = 1;
yaleplotsvd = [];
for k = [1, 2, 3, 5, 10, 15, 20, 30, 50, 60, 65, 75, 100, 200, 300, 500, 1000]
    Ured = zeros(size(U));
    %Ured(:,1:k) = U(:,1:k);
    Ured(:,startk:startk+k-1) = U(:,startk:startk+k-1);
    eigenvec = Ured';
    searchspace = eigenvec*trainvecspace;
    toterr=0;
    %totdist = 0;
    
    queryimgs = eigenvec*testvecspace;
    [idx, Dist] = knnsearch(searchspace',queryimgs');
    
    for i = 1:size(testvecspace,2)
        %queryimg = eigenvec*(testvecspace(:,i)-meanvec);
        %disp(idx(i))
        %[idx,Dist] = knnsearch(searchspace',queryimg');
        if corrtesttag(i) ~= corrtraintag(idx(i))
            toterr=toterr +1;
        end
    end
    %disp(toterr)
    yaleplotsvd = [yaleplotsvd (100*toterr/size(testvecspace,2))];
end
X = [1, 2, 3, 5, 10, 15, 20, 30, 50, 60, 65, 75, 100, 200, 300, 500, 1000];
plot(X,yaleplotsvd)
title('Error Rate (Yale dataset, all top eigen values retained)')
xlabel('Number of eigen values retained')
ylabel('Error rate (Percentage of incorrect identifications)')
%% Error Rate (Yale Dataset) with top (but 3) eigen values
% Performance improves substantially once top eigen values are ignored as
% can be seen in the plot below, allowing us to hit 40% accuracy.
startk = 4;
yaleplotsvd = [];
for k = [1, 2, 3, 5, 10, 15, 20, 30, 50, 60, 65, 75, 100, 200, 300, 500, 1000]
    Ured = zeros(size(U));
    %Ured(:,1:k) = U(:,1:k);
    Ured(:,startk:startk+k-1) = U(:,startk:startk+k-1);
    eigenvec = Ured';
    searchspace = eigenvec*trainvecspace;
    toterr=0;
    %totdist = 0;
    
    queryimgs = eigenvec*testvecspace;
    [idx, Dist] = knnsearch(searchspace',queryimgs');
    
    for i = 1:size(testvecspace,2)
        %queryimg = eigenvec*(testvecspace(:,i)-meanvec);
        %disp(idx(i))
        %[idx,Dist] = knnsearch(searchspace',queryimg');
        if corrtesttag(i) ~= corrtraintag(idx(i))
            toterr=toterr +1;
        end
    end
    %disp(toterr)
    yaleplotsvd = [yaleplotsvd (100*toterr/size(testvecspace,2))];
end
X = [1, 2, 3, 5, 10, 15, 20, 30, 50, 60, 65, 75, 100, 200, 300, 500, 1000];
plot(X,yaleplotsvd)
title('Error Rate (Yale dataset, top (but 3) eigen values retained)')
xlabel('Number of eigen values retained')
ylabel('Error rate (Percentage of incorrect identifications)')


%% References (last accessed 4-11-2020)
% https://in.mathworks.com/matlabcentral/answers/166629-is-there-any-way-to-list-all-folders-only-in-the-level-directly-below-a-selected-directory
%
% https://in.mathworks.com/matlabcentral/answers/341843-load-files-from-relative-path
%
% https://in.mathworks.com/matlabcentral/answers/40018-delete-zeros-rows-and-columns
toc;
##### SOURCE END #####
--></body></html>